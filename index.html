<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LearnFlow - æ™ºèƒ½ä»»åŠ¡è¿½è¸ªç³»ç»Ÿ</title>
  <!-- å¼•å…¥ jsPDF å’Œ html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* æ·»åŠ  CSS æ ·å¼ */
    :root {
  --primary: #6D5FE8;
  --secondary: #00BFFF;
  --bg-light: linear-gradient(135deg, #e6f7ff, #f0f9ff);
  --bg-dark: linear-gradient(135deg, #0d1b2a, #1a2a40);
  --card-bg-light: linear-gradient(135deg, #ffffff, #f8f9fa);
  --card-bg-dark: linear-gradient(135deg, #0d1b2a, #1a2a40);
  /* âœ… æ–‡å­—é¢œè‰²ä¼˜åŒ–ï¼šæµ…è‰²èƒŒæ™¯ç”¨æ·±è‰²æ–‡å­— */
  --text: #1f2d3d;          /* åŸ #FFFFFF â†’ æ·±ç°é»‘ */
  --text-secondary: #606266; /* åŸ #B0C4DE â†’ ä¸­ç°è‰² */
  --success: #4CAF50;
  --warning: #FFC107;
  --danger: #FF5252;
  --accent: #BB86FC;
  --high-priority: #e74c3c;   /* æ·±çº¢ */
  --medium-priority: #f39c12; /* æ·±æ©™ */
  --low-priority: #2ecc71;    /* æ·±ç»¿ */
  --light-border: rgba(0, 0, 0, 0.1);
  --dark-border: rgba(255, 255, 255, 0.1);
  --shadow-light: 0 10px 30px rgba(0, 0, 0, 0.05);
  --shadow-dark: 0 10px 30px rgba(0, 0, 0, 0.3);
  --input-bg-light: rgba(255, 255, 255, 0.9);
  --input-bg-dark: rgba(30, 40, 60, 0.7);
  --white: #FFFFFF;
  --black: #000000;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', system-ui, sans-serif;
}

body {
  background: var(--bg-light);
  color: var(--text);
  min-height: 100vh;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  transition: background 0.5s ease;
}

.container {
  max-width: 1200px;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

header {
  text-align: center;
  width: 100%;
  margin-top: 20px;
}

header h1 {
  font-size: 2.4rem;
  color: var(--primary);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  margin-bottom: 8px;
}

header h1 svg {
  width: 42px;
  height: 42px;
  fill: var(--primary);
}

header p {
  color: var(--text-secondary);
  font-size: 0.95rem;
  font-weight: 500;
}

.cards-container {
  display: flex;
  justify-content: space-between;
  width: 1500px;
  gap: 24px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.main-card, .stats-card {
  flex: 1;
  width: 320px;
  background: var(--card-bg-light);
  border-radius: 20px;
  padding: 28px;
  box-shadow: var(--shadow-light);
  border: 1px solid var(--light-border);
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
}

.main-card:hover,
.stats-card:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-light);
}

.section-title {
  font-size: 1.35rem;
  margin-bottom: 20px;
  color: var(--accent);
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
}

.section-title::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 0;
  width: 36px;
  height: 2.5px;
  background: var(--accent);
  border-radius: 2px;
}

/* === ä»»åŠ¡é¡¹æ ·å¼ === */
.task-item {
  position: relative;
  padding: 16px;
  border-radius: 14px;
  margin-bottom: 14px;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  transition: all 0.3s ease;
  border: 1px solid rgba(0, 0, 0, 0.08);
}

.task-item.completed {
  opacity: 0.7;
  background: rgba(200, 220, 255, 0.5);
}

.task-main {
  flex: 1;
  margin-right: 12px;
}

.task-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.task-time {
  font-size: 0.85rem;
  color: var(--warning);
  background: rgba(255, 193, 7, 0.15);
  padding: 2px 6px;
  border-radius: 4px;
}

.task-category {
  font-size: 0.8rem;
  background: rgba(187, 134, 252, 0.2);
  color: var(--accent);
  padding: 2px 6px;
  border-radius: 4px;
}

.priority-badge {
  font-size: 0.75rem;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: bold;
}

.priority-high { background: rgba(231, 76, 60, 0.2); color: var(--high-priority); }
.priority-medium { background: rgba(243, 156, 18, 0.2); color: var(--medium-priority); }
.priority-low { background: rgba(46, 204, 113, 0.2); color: var(--low-priority); }

.task-text {
  font-size: 1.05rem;
  color: var(--text);
  word-break: break-word;
}

.task-actions {
  display: flex;
  gap: 8px;
  align-self: flex-start;
}

/* === å›¾æ ‡ç»Ÿä¸€å¤§å° & è·³è¿‡ä»»åŠ¡å›¾æ ‡æ›´æ¢ === */
.complete-btn,
.skip-btn,
.delete-btn,
.btn-detail {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid;
  color: white;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.complete-btn {
  border-color: var(--success);
  color: var(--success);
  background: transparent;
}

.complete-btn:hover {
  background: rgba(76, 175, 80, 0.15);
  transform: scale(1.1);
}

.complete-btn.completed {
  background: var(--success) !important;
  border-color: var(--success) !important;
  color: white !important;
  box-shadow: 0 0 15px rgba(76, 175, 80, 0.6);
  animation: pulseGlow 1.5s infinite alternate;
}

@keyframes pulseGlow {
  from { box-shadow: 0 0 10px rgba(76, 175, 80, 0.6); }
  to { box-shadow: 0 0 25px rgba(76, 175, 80, 0.9), 0 0 35px rgba(76, 175, 80, 0.7); }
}

.delete-btn {
  border-color: var(--danger);
  color: var(--danger);
  background: transparent;
}

.delete-btn:hover {
  background: rgba(255, 82, 82, 0.15);
  transform: scale(1.1);
}

.skip-btn {
  border-color: var(--warning);
  color: var(--warning);
  background: transparent;
  font-size: 16px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.skip-btn:hover {
  background: rgba(255, 193, 7, 0.15);
  transform: scale(1.1);
}

/* æ‚¬åœæç¤º */
.task-actions button[title] {
  position: relative;
}

.task-actions button[title]:hover::after {
  content: attr(title);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--text-secondary);
  color: white;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* === æ·»åŠ ä»»åŠ¡è¡¨å• === */
.add-task-form {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.add-task-form input[type="text"] {
  flex: 1;
  padding: 10px 14px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  background: var(--input-bg-light);
  color: var(--text);
  font-size: 0.95rem;
  outline: none;
}

.add-task-form select {
  padding: 10px 14px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  background: var(--input-bg-light);
  color: var(--text);
  font-size: 0.95rem;
  outline: none;
}

.add-task-form button {
  padding: 10px 16px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s ease;
}

.add-task-form button:hover {
  background: #5a4cbf;
}

/* === æ—¥æœŸé€‰æ‹©æ¡†ç¾åŒ– === */
.date-picker {
  margin-bottom: 16px;
}

.date-picker select {
  padding: 10px 14px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 12px;
  background: var(--input-bg-light);
  color: var(--text);
  font-size: 0.95rem;
  outline: none;
  width: 180px;
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z' fill='%23666666'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 12px;
  transition: all 0.3s ease;
}

.date-picker select:hover {
  border-color: var(--accent);
  box-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
}

/* === æ—¶é—´æ®µé€‰æ‹©å™¨ === */
.time-range-select {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 10px;
}

.time-range-select select {
  padding: 8px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 6px;
  background: var(--input-bg-light);
  color: var(--text);
  font-size: 0.9rem;
  outline: none;
  width: 140px;
}

.time-range-select label {
  color: var(--text-secondary);
  font-size: 0.85rem;
}

/* === ç•ªèŒ„é’Ÿ === */
.pomodoro-container {
  margin-top: 20px;
  text-align: center;
  position: relative;
  width: 100%;
}

.pomodoro-container h3 {
  color: var(--accent);
  margin-bottom: 10px;
  font-size: 1.2rem;
  text-align: center;
}

.pomodoro-clock {
  font-size: 2.5rem;
  font-weight: bold;
  color: var(--primary);
  margin: 10px 0;
  padding: 15px;
  border-radius: 12px;
  background: rgba(109, 95, 232, 0.1);
  border: 2px solid var(--primary);
  box-shadow: 0 0 20px rgba(109, 95, 232, 0.3);
  text-align: center;
}

.pomodoro-controls {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 10px;
}

.pomodoro-controls button {
  padding: 8px 16px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.3s ease;
}

.pomodoro-controls button:hover {
  background: #a177e5;
}

/* === ç§¯åˆ†æç¤ºåŠ¨ç”» === */
.points-popup {
  position: absolute;
  top: -40px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(76, 175, 80, 0.9);
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: bold;
  opacity: 0;
  animation: floatUp 1s forwards;
  pointer-events: none;
}

@keyframes floatUp {
  0% { opacity: 0; transform: translate(-50%, 0); }
  20% { opacity: 1; }
  100% { opacity: 0; transform: translate(-50%, -40px); }
}

/* === ç»Ÿè®¡å¡ === */
.progress-ring {
  width: 130px;
  height: 130px;
  position: relative;
  margin: 0 auto 16px;
}

.progress-ring > svg {
  width: 100%;
  height: 100%;
}

.progress-ring .circle {
  fill: none;
  stroke: rgba(0, 0, 0, 0.1);
  stroke-width: 10;
  stroke-linecap: round;
  transform: rotate(-90deg);
  transform-origin: center;
}

.progress-ring .circle-progress {
  stroke: var(--accent);
  stroke-width: 10;
  stroke-linecap: round;
  transform: rotate(-90deg);
  transform-origin: center;
  transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-text {
  text-align: center;
  font-size: 1.4rem;
  font-weight: bold;
  color: var(--accent);
  margin-bottom: 16px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 2;
}

.stat-item {
  background: rgba(255, 255, 255, 0.8);
  border-radius: 14px;
  padding: 18px;
  margin-bottom: 18px;
  text-align: center;
  border: 1px solid rgba(0, 0, 0, 0.08);
  backdrop-filter: blur(6px);
}

.stat-label {
  font-size: 0.95rem;
  color: var(--text-secondary);
  margin-bottom: 8px;
}

.stat-value {
  font-size: 1.9rem;
  font-weight: bold;
  color: #1f2d3d;
}

.dark-mode .stat-value {
  color: rgb(223, 223, 223) !important;
}

/* === ç»Ÿè®¡å¡ç‰‡é¡¹ï¼ˆå®Œæˆç‡ & ç§¯åˆ†ï¼‰=== */

/* æ·±è‰²æ¨¡å¼å¢å¼º */
.dark-mode .stat-item {
  background: rgba(30, 41, 59, 0.8);
}

/* === ç§¯åˆ†åˆ—è¡¨ === */
.reward-list {
  margin-top: 20px;
}

.reward-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 0;
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
}

.reward-points {
  background: var(--accent);
  color: var(--text);
  padding: 4px 10px;
  border-radius: 8px;
  font-size: 0.85rem;
  font-weight: bold;
}

/* === æ–°å¢ï¼šæŸ±çŠ¶å›¾å®¹å™¨ === */
.chart-container {
  width: 100%;
  height: 180px;
  margin-top: 20px;
}

/* === ä¸»é¢˜åˆ‡æ¢æŒ‰é’® === */
.theme-toggle {
  position: absolute;
  top: 20px;
  right: 20px;
}

.theme-toggle button {
  padding: 8px 16px;
  border-radius: 20px;
  background: var(--accent);
  color: white;
  border: none;
  cursor: pointer;
  font-size: 1rem;
}

/* === å¯¼å‡ºæŒ‰é’®ä½ç½®è°ƒæ•´ === */
.export-button {
  position: absolute;
  top: 20px;
  right: 100px;
  padding: 8px 16px;
  background: var(--success);
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 1rem;
  transition: background 0.3s ease;
}

.export-button:hover {
  background: #388e3c;
}

/* === å¤œé—´æ¨¡å¼å¢å¼ºï¼šå¡ç‰‡èƒŒæ™¯å±‚æ¬¡æ„Ÿ === */
.main-card.dark-mode {
  background: var(--card-bg-dark);
  border: 1px solid var(--dark-border);
}

.stats-card.dark-mode {
  background: var(--card-bg-dark);
  border: 1px solid var(--dark-border);
}

.task-item.dark-mode {
  background: rgba(30, 40, 60, 0.8);
  border: 1px solid var(--dark-border);
}

.task-time.dark-mode {
  background: rgba(255, 193, 7, 0.1);
}

.task-category.dark-mode {
  background: rgba(187, 134, 252, 0.2);
}

.task-text.dark-mode {
  color: var(--white);
}

.time-range-select select.dark-mode {
  background: var(--input-bg-dark);
  color: var(--white);
  border: 1px solid var(--dark-border);
}

.date-picker select.dark-mode {
  background: var(--input-bg-dark);
  color: var(--white);
  border: 1px solid var(--dark-border);
}

.add-task-form input.dark-mode,
.add-task-form select.dark-mode {
  background: var(--input-bg-dark);
  color: var(--white);
  border: 1px solid var(--dark-border);
}

.task-actions button.dark-mode {
  border-color: rgba(255, 255, 255, 0.3);
}

.complete-btn.dark-mode {
  border-color: #4CAF50;
  color: #4CAF50;
}

.skip-btn.dark-mode {
  border-color: #FFC107;
  color: #FFC107;
}

.delete-btn.dark-mode {
  border-color: #FF5252;
  color: #FF5252;
}

/* === æ‰€æœ‰å…ƒç´ åœ¨å¤œé—´æ¨¡å¼ä¸‹çš„æ–‡æœ¬å¯è§æ€§å¢å¼º === */
.dark-mode {
  color: var(--white);
}

.dark-mode .section-title {
  color: var(--accent);
}

.dark-mode .stat-label{
  color: #dcdee0;
}

.dark-mode .task-header {
  color: var(--white);
}

.dark-mode .task-text {
  color: var(--white);
}

/* ä¿®å¤ï¼šç™¾åˆ†æ¯”æ–‡å­—ä¸ä¼šæº¢å‡ºå¡ç‰‡ */
.progress-text {
  margin-bottom: 16px;
  font-size: 1.4rem;
  color: var(--accent);
  line-height: 1.2;
}

/* ä¿®å¤ï¼šç§¯åˆ†æç¤ºæ–‡å­—å±…ä¸­å¹¶å¢åŠ é—´è· */
.stats-card .stat-item:last-child {
  margin-bottom: 12px;
}

/* ä¿®å¤ï¼šå¥–åŠ±åˆ—è¡¨è¾¹è· */
.reward-list {
  margin-top: 20px;
}

.reward-item:last-child {
  border-bottom: none;
}

/* ç¡®ä¿æ‰€æœ‰å¡ç‰‡å†…å…ƒç´ éƒ½é€‚é… */
.stats-card {
  padding: 24px;
  min-width: 300px;
}

/* ä¿®å¤ï¼šè¾“å…¥æ¡†å†…çš„æ–‡å­—ä¸ºé»‘è‰² */
.add-task-form input:focus,
.add-task-form select:focus {
  outline: none;
  box-shadow: 0 0 0 2px rgba(109, 95, 232, 0.3);
}

/* é€€å‡ºä¸“æ³¨æŒ‰é’® - é»˜è®¤éšè— */
.zen-exit-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  padding: 8px 16px;
  background: #6D5FE8;
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 0.9rem;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(109, 95, 232, 0.3);
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.2s ease;
}

/* è¿›å…¥ä¸“æ³¨æ¨¡å¼åæ˜¾ç¤º */
.zen-mode .zen-exit-btn {
  opacity: 1;
  visibility: visible;
  top: 30px;
  right: 450px;
}

/* === ä¸“æ³¨æ¨¡å¼ === */
.zen-mode .header p,
/* .zen-mode .pomodoro-container, */
.zen-mode .date-picker,
.zen-mode .time-range-select,
.zen-mode .add-task-form,
.zen-mode .stats-card,
.zen-mode .theme-toggle,
.zen-mode .export-button,
.zen-mode .utility-buttons {
  display: none !important;
}

.zen-mode .container {
  max-width: 800px;
}

.zen-mode .main-card {
  margin-top: 20px;
}

/* === ä¸“æ³¨æ¨¡å¼ä¸‹å¼ºåŒ–ç•ªèŒ„é’Ÿ === */
.zen-mode .pomodoro-container {
  position: sticky;
  top: 20px;
  z-index: 10;
  width: 100%;
  max-width: 500px;
  margin: 0 auto 30px !important;
  padding: 20px;
  background: var(--card-bg-light);
  border-radius: 20px;
  box-shadow: var(--shadow-light);
  border: 1px solid var(--light-border);
}
.dark-mode .zen-mode .pomodoro-container {
  background: var(--card-bg-dark);
  border: 1px solid var(--dark-border);
}
.zen-mode .pomodoro-clock {
  font-size: 3.2rem;
  margin: 15px 0;
}
.zen-mode .pomodoro-controls button {
  padding: 12px 24px;
  font-size: 1.1rem;
}

/* === å·¥å…·æŒ‰é’® === */
.utility-buttons {
  position: absolute;
  top: 20px;
  right: 240px;
  display: flex;
  gap: 8px;
}

.utility-button {
  padding: 8px 12px;
  background: var(--secondary);
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.utility-button:hover {
  background: #00a0e0;
  transform: translateY(-2px);
}

.dark-mode .utility-button {
  background: #00a0e0;
}

.dark-mode .utility-button:hover {
  background: #008fc0;
}

/* === å¾®åŠ¨ç”» === */
.completion-animation {
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(76, 175, 80, 0.9);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: bold;
  opacity: 0;
  animation: floatUp 1.2s forwards;
  pointer-events: none;
  z-index: 10;
}

@keyframes floatUp {
  0% {
    opacity: 0;
    transform: translate(-50%, 0);
  }
  20% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50px);
  }
}

/* === ä»»åŠ¡é¡¹å¢å¼º === */
.task-extra {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px solid var(--light-border);
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.dark-mode .task-extra {
  border-top: 1px solid var(--dark-border);
}

.btn-detail {
  border-color: var(--accent);
  /* color: var(--danger); */
  background: transparent;
}

.btn-detail:hover {
  background: rgba(187, 134, 252, 0.15);
  transform: scale(1.1);
}

/* .btn-detail.dark-mode {
  border-color: #FF5252;
  color: #FF5252;
} */
/* .btn-detail:hover {
  background: rgba(187, 134, 252, 0.15);
  transform: scale(1.1);
} */

.dark-mode .btn-detail {
  border-color: var(--accent);
  color: var(--accent);
}

/* === å¢å¼ºç‰ˆä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† === */
/* === å¢å¼ºç‰ˆä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† === */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* é»˜è®¤ï¼ˆæ—¥é—´ï¼‰æ¯›ç»ç’ƒæ ·å¼ï¼šç±³ç™½ + è½»å¾®é€æ˜ */
#task-detail-modal .modal-content {
  background: rgba(253, 252, 248, 0.85); /* æ›´æŸ”å’Œçš„ç±³ç™½ï¼Œéçº¯ç™½ */
  border: 1px solid rgba(0, 0, 0, 0.1);
  color: #333; /* æ—¥é—´æ–‡å­—æ·±ç°ï¼Œä¸åˆºçœ¼ */
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  margin: 6% auto;
  padding: 32px;
  border-radius: 20px;
  width: 90%;
  max-width: 580px;
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
  position: relative;
  max-height: 85vh;
  overflow-y: auto;
}

/* æ·±è‰²æ¨¡å¼ï¼šæŸ”å’ŒçŸ³å¢¨ç°ï¼ˆå‚è€ƒ Apple Notes æäº®ç‰ˆï¼‰ */
.dark-mode #task-detail-modal .modal-content {
  background: rgba(65, 65, 72, 0.85); /* â† å…³é”®ï¼šæ¯”åŸæ·±ç°æ›´æŸ”å’Œ */
  border: 1px solid rgba(255, 255, 255, 0.12);
  color: #e0e0ff; /* ä¸»æ–‡å­—ï¼šæ·¡è“ç´«ï¼Œä¸åˆºçœ¼ */
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
}

/* å…³é—­æŒ‰é’® */
#task-detail-modal .close {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 28px;
  color: #aaa;
  cursor: pointer;
  z-index: 10;
  font-weight: normal;
}

#task-detail-modal .close:hover {
  color: var(--danger);
}

.dark-mode #task-detail-modal .close {
  color: #b3b3d5; /* å¤œé—´å…³é—­æŒ‰é’®ä¹ŸæŸ”å’ŒåŒ– */
}
.dark-mode #task-detail-modal .close:hover {
  color: #ff8c8c; /* ç¨äº®çº¢ï¼Œä½†ä¸è¿‡é¥±å’Œ */
}

/* æ ‡é¢˜ï¼šå¤œé—´ç”¨ç¨äº®ä½†ä¸åˆºçœ¼çš„æŸ”ç™½ */
#task-detail-modal h3 {
  font-size: 1.6rem;
  color: var(--primary);
  text-align: center;
  margin-bottom: 28px;
  font-weight: 700;
}

.dark-mode #task-detail-modal h3 {
  color: #c8c8f0; /* æŸ”å’Œæ ‡é¢˜è‰² */
}

/* å†…å®¹é¡¹å¸ƒå±€ */
.modal-item {
  display: flex;
  align-items: flex-start;
  gap: 14px;
  margin-bottom: 20px;
  line-height: 1.55;
}

.modal-icon {
  font-size: 1.4rem;
  min-width: 28px;
  text-align: center;
  color: var(--accent);
  flex-shrink: 0;
}

/* å¼ºè°ƒæ–‡å­—ï¼ˆå¦‚â€œæ—¶é—´ï¼šâ€ã€â€œåˆ†ç±»ï¼šâ€ï¼‰ */
#task-detail-modal strong {
  color: #333;
  min-width: 80px;
  font-weight: 600;
}

.dark-mode #task-detail-modal strong {
  color: #b3b3d5; /* æ¬¡è¦ä¿¡æ¯ç”¨æµ…ç°ç´« */
}

/* å­¦ä¹ æ–¹æ³•æ­¥éª¤ */
.method-steps {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 6px;
  align-items: center;
}

.method-step {
  background: rgba(187, 134, 252, 0.15);
  color: var(--accent);
  padding: 4px 10px;
  border-radius: 6px;
  font-size: 0.92rem;
  font-weight: 500;
}

/* å¤œé—´æ¨¡å¼ä¸‹æ–¹æ³•æ­¥éª¤æ–‡å­—ä¹Ÿéœ€æŸ”å’Œ */
.dark-mode .method-step {
  color: #c8c8f0;
  background: rgba(100, 90, 130, 0.4); /* èƒŒæ™¯ä¹Ÿé™ä½äº®åº¦ */
  border: 1px solid rgba(150, 140, 190, 0.3);
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
#task-detail-modal .modal-content::-webkit-scrollbar {
  width: 6px;
}
#task-detail-modal .modal-content::-webkit-scrollbar-track {
  background: transparent;
}
#task-detail-modal .modal-content::-webkit-scrollbar-thumb {
  background: rgba(187, 134, 252, 0.3);
  border-radius: 3px;
}

/* å…³é—­æŒ‰é’®ï¼ˆåº•éƒ¨å¤§æŒ‰é’®ï¼‰ */
.modal-close-btn {
  display: block;
  width: 100%;
  padding: 12px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  margin-top: 20px;
  transition: background 0.3s ease;
}

.modal-close-btn:hover {
  background: #5a4cbf;
}

/* å¤œé—´æ¨¡å¼ä¸‹åº•éƒ¨æŒ‰é’®æ–‡å­—ä¹Ÿéœ€æŸ”å’Œï¼ˆå¦‚æœèƒŒæ™¯æ˜¯æ·±è‰²ï¼‰ */
.dark-mode .modal-close-btn {
  color: #f0f0ff;
  background: rgba(100, 90, 160, 0.8);
}
.dark-mode .modal-close-btn:hover {
  background: rgba(120, 110, 180, 0.9);
}

/* å“åº”å¼ */
@media (max-width: 600px) {
  #task-detail-modal .modal-content {
    padding: 24px 20px;
    margin: 8% auto;
  }
  .modal-item {
    gap: 12px;
  }
  .modal-icon {
    font-size: 1.2rem;
  }
}
  </style>
  
</head>
<body>
  <div class="container">
    <header>
      <h1>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        LearnFlow
      </h1>
      <p>æ™ºèƒ½ä»»åŠ¡è¿½è¸ªç³»ç»Ÿ â€¢ 2026.02.08 â€“ 2026.02.28</p>
           <!-- ä¸“æ³¨æ¨¡å¼é€€å‡ºæŒ‰é’®ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <button id="exit-zen-mode" class="zen-exit-btn">é€€å‡ºä¸“æ³¨</button>
    </header>

    <!-- ç•ªèŒ„é’ŸåŒºåŸŸ -->
    <div class="pomodoro-container">
      <h3>ğŸ… ç•ªèŒ„é’Ÿ</h3>
      <div class="pomodoro-clock" id="pomodoro-clock">25:00</div>
      <div class="pomodoro-controls">
        <button onclick="startPomodoro()">å¼€å§‹</button>
        <button onclick="pausePomodoro()">æš‚åœ</button>
        <button onclick="resetPomodoro()">é‡ç½®</button>
      </div>
    </div>

    <!-- å¯¼å‡ºæŠ¥å‘ŠæŒ‰é’®ï¼ˆç§»åŠ¨è‡³å³ä¸Šè§’ï¼‰ -->
    <button class="export-button" onclick="exportReport()">ğŸ“„ å¯¼å‡ºæŠ¥å‘Š</button>

    <!-- æ–°å¢ï¼šä¸“æ³¨æ¨¡å¼å’Œå¤‡ä»½æ¢å¤æŒ‰é’® -->
    <div class="utility-buttons">
      <button class="utility-button" id="zen-mode">ğŸ§˜ ä¸“æ³¨æ¨¡å¼</button>
      <button class="utility-button" id="backup-data">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
      <input type="file" id="restore-file" accept=".json" style="display: none;">
      <button class="utility-button" id="restore-data">ğŸ“¤ æ¢å¤æ•°æ®</button>
    </div>

    <div class="cards-container">
      <!-- å·¦ä¾§ï¼šä»»åŠ¡å¡ç‰‡ -->
      <div class="main-card">
        <div class="section-title">ğŸ“… ä»Šæ—¥ä»»åŠ¡</div>
        <div class="date-picker">
          <label for="date-select">é€‰æ‹©æ—¥æœŸï¼š</label>
          <select id="date-select" onchange="loadTasks()">
            <option value="2026-02-08">2026-02-08</option>
            <option value="2026-02-09">2026-02-09</option>
            <option value="2026-02-10">2026-02-10</option>
          </select>
        </div>

        <div class="add-task-form">
          <input type="text" id="new-task-input" placeholder="è¾“å…¥ä»»åŠ¡..." />
          <div class="time-range-select">
            <select id="time-slot">
              <option value="07:00-08:00">7:00 - 8:00</option>
              <option value="07:30-08:30">7:30 - 8:30</option>
              <option value="08:00-09:00">8:00 - 9:00</option>
              <option value="08:30-09:30">8:30 - 9:30</option>
              <option value="09:00-10:00">9:00 - 10:00</option>
              <option value="19:00-20:00">19:00 - 20:00</option>
              <option value="20:00-21:00">20:00 - 21:00</option>
              <option value="21:00-22:00">21:00 - 22:00</option>
            </select>
          </div>
          <select id="priority-select">
            <option value="low">ä½</option>
            <option value="medium">ä¸­</option>
            <option value="high">é«˜</option>
          </select>
          <button onclick="addTask()">æ·»åŠ </button>
        </div>

        <div id="task-container">åŠ è½½ä¸­...</div>
      </div>

      <!-- å³ä¾§ï¼šç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats-card">
        <div class="section-title">ğŸ“Š å­¦ä¹ ç»Ÿè®¡</div>
        <div class="progress-ring" id="progress-ring">
          <svg viewBox="0 0 100 100">
            <circle class="circle" cx="50" cy="50" r="45" />
            <circle class="circle-progress" cx="50" cy="50" r="45" />
          </svg>
          <div class="progress-text" id="progress-text">0%</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å½“æ—¥å®Œæˆç‡</div>
          <div class="stat-value" id="completion-rate">0%</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">å½“å‰ç§¯åˆ†</div>
          <div class="stat-value" id="points">0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 4px;">ğŸ’ å¯å…‘æ¢å¥–åŠ±</div>
        </div>

        <div class="section-title">ğŸ“ˆ è¿‘7å¤©å®Œæˆæƒ…å†µ</div>
        <div class="chart-container">
          <canvas id="daily-chart"></canvas>
        </div>

        <div class="section-title">ğŸ å¥–åŠ±æ¸…å•</div>
        <div class="reward-list">
          <div class="reward-item">
            <span>çœ‹ä¸€é›†åŠ¨æ¼«</span>
            <span class="reward-points">100åˆ†</span>
          </div>
          <div class="reward-item">
            <span>ç‚¹ä¸€æ¯å¥¶èŒ¶</span>
            <span class="reward-points">200åˆ†</span>
          </div>
          <div class="reward-item">
            <span>è‡ªç”±åŠå¤©</span>
            <span class="reward-points">500åˆ†</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <div class="theme-toggle">
      <button onclick="toggleTheme()">ğŸŒ™</button>
    </div>
  </div>

  <!-- ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† -->
  <div id="task-detail-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="modal-content">
        <!-- åŠ¨æ€å†…å®¹ -->
      </div>
      <button id="close-detail" class="modal-close-btn">å…³é—­</button>
    </div>
  </div>

  <script>

    
// å…¨å±€æ•°æ®ï¼šæ‰€æœ‰ä»»åŠ¡ completed = false
const plan = {
  "2026-02-08": [
    { 
      time: "19:00", 
      title: "FastAPI è¯·æ±‚å‚æ•°å¤„ç†", 
      completed: false, 
      category: "ç¼–ç¨‹", 
      priority: "high",
      goal: "æŒæ¡ FastAPI è¯·æ±‚å‚æ•°å¤„ç†æ–¹æ³•",
      task: "é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œç¼–å†™ç¤ºä¾‹ä»£ç ",
      resources: "FastAPI å®˜ç½‘, GitHub ç¤ºä¾‹ä»“åº“",
      method: "å…ˆçœ‹æ–‡æ¡£ â†’ å†å†™ä»£ç  â†’ æœ€åè°ƒè¯•"
    },
    { 
      time: "20:00", 
      title: "LeetCode ç®—æ³•é¢˜ï¼ˆç¬¬1é¢˜ï¼‰", 
      completed: false, 
      category: "ç¼–ç¨‹", 
      priority: "medium",
      goal: "ç†è§£ä¸¤æ•°ä¹‹å’Œçš„å“ˆå¸Œè§£æ³•",
      task: "å®Œæˆ LeetCode ç¬¬1é¢˜å¹¶æäº¤",
      resources: "LeetCode é¢˜è§£, ç®—æ³•å¯¼è®º",
      method: "å…ˆæš´åŠ›è§£ â†’ å†ä¼˜åŒ– â†’ åˆ†ææ—¶é—´å¤æ‚åº¦"
    },
    { 
      time: "21:00", 
      title: "è‹±è¯­å•è¯å¤ä¹ ï¼ˆç™¾è¯æ–©ï¼‰", 
      completed: false, 
      category: "è‹±è¯­", 
      priority: "low",
      goal: "è®°å¿†50ä¸ªæ–°GREè¯æ±‡",
      task: "å®Œæˆç™¾è¯æ–©ä»Šæ—¥ä»»åŠ¡",
      resources: "ç™¾è¯æ–©APP, GREè¯é¢‘è¡¨",
      method: "è‰¾å®¾æµ©æ–¯è®°å¿†æ³• + ä¾‹å¥è”æƒ³"
    }
  ],
  "2026-02-09": [
    { 
      time: "19:00", 
      title: "FastAPI å“åº”æ¨¡å‹", 
      completed: false, 
      category: "ç¼–ç¨‹", 
      priority: "high",
      goal: "å­¦ä¼šå®šä¹‰ Pydantic å“åº”æ¨¡å‹",
      task: "ç¼–å†™ç”¨æˆ·ä¿¡æ¯è¿”å›æ¥å£",
      resources: "FastAPI æ–‡æ¡£, Pydantic æŒ‡å—",
      method: "æ¨¡ä»¿ç¤ºä¾‹ â†’ ä¿®æ”¹å­—æ®µ â†’ æµ‹è¯•éªŒè¯"
    },
    { 
      time: "20:00", 
      title: "è‹±è¯­å¬åŠ›ç»ƒä¹ ï¼ˆVOAï¼‰", 
      completed: false, 
      category: "è‹±è¯­", 
      priority: "medium",
      goal: "æå‡æ–°é—»å¬åŠ›ç†è§£èƒ½åŠ›",
      task: "å¬å†™ VOA æ…¢é€Ÿè‹±è¯­1ç¯‡",
      resources: "VOA Learning English",
      method: "ç›²å¬ â†’ é€å¥å¬å†™ â†’ å¯¹ç…§åŸæ–‡"
    }
  ],
  "2026-02-10": [],
  "2026-02-11": [],
  "2026-02-12": [],
  "2026-02-13": [],
  "2026-02-14": []
};

let isZenMode = false;
let pomodoroInterval = null;
let remainingTime = 25 * 60; // 25åˆ†é’Ÿï¼ˆç§’ï¼‰
let soundEnabled = true;

function getPriorityClass(priority) {
  return `priority-${priority}`;
}

function loadTasks() {
  const selectedDate = document.getElementById('date-select').value;
  const taskContainer = document.getElementById('task-container');
  const dayTasks = plan[selectedDate] || [];

  if (dayTasks.length === 0) {
    taskContainer.innerHTML = '<p style="color: #aaa; text-align: center; margin: 20px; font-style: italic;">ä»Šå¤©æ²¡æœ‰å®‰æ’ä»»åŠ¡ ğŸ˜Š</p>';
    updateStats(selectedDate, 0, 0);
    return;
  }

  const tasksHTML = dayTasks.map((task, index) => `
    <div class="task-item ${task.completed ? 'completed' : ''}" data-index="${index}">
      <div class="task-main">
        <div class="task-header">
          <span class="task-time">${task.time}</span>
          <span class="task-category">${task.category}</span>
          <span class="priority-badge ${getPriorityClass(task.priority)}">${task.priority === 'high' ? 'é«˜' : task.priority === 'medium' ? 'ä¸­' : 'ä½'}</span>
        </div>
        <div class="task-text">${task.title}</div>
      </div>
      <div class="task-actions">
        <button class="complete-btn ${task.completed ? 'completed' : ''}" 
                onclick="completeTask('${selectedDate}', ${index}, this)" title="æ ‡è®°ä¸ºå®Œæˆ">
          ${task.completed ? 'âœ“' : 'âœ“'}
        </button>
        <button class="skip-btn" title="è·³è¿‡æ­¤ä»»åŠ¡" onclick="skipTask('${selectedDate}', ${index})">âš¡</button>
        <button class="delete-btn" title="åˆ é™¤ä»»åŠ¡" onclick="deleteTask('${selectedDate}', ${index})">Ã—</button>
        <button class="btn-detail" title="æŸ¥çœ‹è¯¦æƒ…" onclick="showTaskDetail('${selectedDate}', ${index})">â„¹ï¸</button>
      </div>
    </div>
  `).join('');

  taskContainer.innerHTML = tasksHTML;

  const completed = dayTasks.filter(t => t.completed).length;
  updateStats(selectedDate, dayTasks.length, completed);
}

function completeTask(date, index, btn) {
  const task = plan[date][index];
  if (task.completed) {
    task.completed = false;
    btn.classList.remove('completed');
  } else {
    task.completed = true;
    btn.classList.add('completed');
    showCompletionAnimation(btn, '+10');
  }

  const total = plan[date].length;
  const completed = plan[date].filter(t => t.completed).length;
  updateStats(date, total, completed);

  // æ›´æ–°å›¾è¡¨
  updateChart();
}

function skipTask(date, index) {
  if (!confirm('ç¡®å®šè¦è·³è¿‡è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;
  plan[date][index].skipped = true;
  plan[date][index].completed = false;
  loadTasks();
}

function deleteTask(date, index) {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) return;
  plan[date].splice(index, 1);
  loadTasks();
}

function addTask() {
  const input = document.getElementById('new-task-input');
  const taskTitle = input.value.trim();
  const timeSlot = document.getElementById('time-slot').value;
  const prioritySelect = document.getElementById('priority-select').value;
  const selectedDate = document.getElementById('date-select').value;

  if (!taskTitle) return;

  const newTask = {
    time: timeSlot.split('-')[0],
    title: taskTitle,
    completed: false,
    category: "å…¶ä»–",
    priority: prioritySelect,
    goal: "",
    task: "",
    resources: "",
    method: ""
  };

  if (!plan[selectedDate]) plan[selectedDate] = [];
  plan[selectedDate].push(newTask);

  input.value = '';
  document.getElementById('time-slot').value = '19:00-20:00';
  loadTasks();
}

function showTaskDetail(date, index) {
  const task = plan[date][index];

  const iconMap = {
    time: 'â±',
    category: 'ğŸ·',
    priority: 'ğŸ”¥',
    goal: 'ğŸ¯',
    task: 'ğŸ“‹',
    resources: 'ğŸ“š',
    method: 'ğŸ§ '
  };

  let detailHTML = `<h3>${task.title}</h3>`;

  detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.time}</span><strong>æ—¶é—´ï¼š</strong>${task.time}</div>`;
  detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.category}</span><strong>åˆ†ç±»ï¼š</strong>${task.category}</div>`;
  const priorityText = task.priority === 'high' ? 'é«˜' : task.priority === 'medium' ? 'ä¸­' : 'ä½';
  detailHTML += `
    <div class="modal-item">
      <span class="modal-icon">${iconMap.priority}</span>
      <strong>ä¼˜å…ˆçº§ï¼š</strong>
      <span class="priority-tag ${task.priority}">${priorityText}</span>
    </div>
  `;

  if (task.goal) detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.goal}</span><strong>å­¦ä¹ ç›®æ ‡ï¼š</strong>${task.goal}</div>`;
  if (task.task) detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.task}</span><strong>å­¦ä¹ ä»»åŠ¡ï¼š</strong>${task.task}</div>`;
  if (task.resources) detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.resources}</span><strong>å­¦ä¹ èµ„æºï¼š</strong>${task.resources}</div>`;
  if (task.method) {
    const steps = task.method.split(/â†’|->|â€”|â€“|-/).map(s => s.trim()).filter(Boolean);
    if (steps.length > 1) {
      const stepsHTML = steps.map(step => `<span class="method-step">${step}</span>`).join(' â†’ ');
      detailHTML += `
        <div class="modal-item">
          <span class="modal-icon">${iconMap.method}</span>
          <strong>å­¦ä¹ æ–¹æ³•ï¼š</strong>
          <div class="method-steps">${stepsHTML}</div>
        </div>
      `;
    } else {
      detailHTML += `<div class="modal-item"><span class="modal-icon">${iconMap.method}</span><strong>å­¦ä¹ æ–¹æ³•ï¼š</strong>${task.method}</div>`;
    }
  }

  document.getElementById('modal-content').innerHTML = detailHTML;
  document.getElementById('task-detail-modal').style.display = 'block';
}

function closeDetailModal() {
  document.getElementById('task-detail-modal').style.display = 'none';
}

function showCompletionAnimation(btn, text) {
  const animation = document.createElement('div');
  animation.className = 'completion-animation';
  animation.textContent = text;
  btn.parentElement.appendChild(animation);

  setTimeout(() => {
    if (animation.parentNode) {
      animation.parentNode.removeChild(animation);
    }
  }, 1200);
}

function updateStats(date, total, completed) {
  const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
  const points = completed * 10;

  const progressText = document.getElementById('progress-text');
  progressText.textContent = `${completed}/${total}`;

  document.getElementById('completion-rate').textContent = `${completionRate}%`;
  document.getElementById('points').textContent = points;

  const progressRing = document.querySelector('.circle-progress');
  const circumference = 2 * Math.PI * 45;
  const offset = circumference - (completionRate / 100) * circumference;
  progressRing.style.strokeDashoffset = offset;
}

// âœ… å…³é”®ä¿®æ”¹ï¼šå›ºå®šè¿‘7å¤©ä¸º 2026-02-08 åˆ° 2026-02-14
function updateChart() {
  const ctx = document.getElementById('daily-chart').getContext('2d');
  if (window.dailyChart) window.dailyChart.destroy();

  const dates = [
    '2026-02-08', '2026-02-09', '2026-02-10',
    '2026-02-11', '2026-02-12', '2026-02-13', '2026-02-14'
  ];

  const dailyCounts = dates.map(date => {
    const tasks = plan[date] || [];
    return tasks.filter(t => t.completed).length;
  });

  const daysOfWeek = dates.map(date => {
    const d = new Date(date);
    const weekday = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
    return weekday[d.getDay()];
  });

  window.dailyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: daysOfWeek,
      datasets: [{
        label: 'æ¯æ—¥å®Œæˆä»»åŠ¡æ•°',
        data: dailyCounts,
        backgroundColor: '#6D5FE8',
        borderColor: '#BB86FC',
        borderWidth: 2,
        borderRadius: 6,
        barThickness: 30,
        hoverBackgroundColor: '#BB86FC'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(255,255,255,0.1)' },
          ticks: { color: '#ccc' }
        },
        x: {
          grid: { color: 'transparent' },
          ticks: { color: '#ccc' }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: { enabled: true }
      }
    }
  });
}

function toggleTheme() {
  const body = document.body;
  const isDark = body.classList.contains('dark-mode');

  if (isDark) {
    body.classList.remove('dark-mode');
    body.style.background = 'var(--bg-light)';
    document.querySelector('.theme-toggle button').textContent = 'ğŸŒ™';
  } else {
    body.classList.add('dark-mode');
    body.style.background = 'var(--bg-dark)';
    document.querySelector('.theme-toggle button').textContent = 'â˜€ï¸';
  }

  const elements = document.querySelectorAll(
    '.main-card, .stats-card, .task-item, .time-range-select select, .date-picker select, .add-task-form input, .add-task-form select, .complete-btn, .skip-btn, .delete-btn'
  );
  elements.forEach(el => el.classList.toggle('dark-mode', !isDark));
}

function formatTime(seconds) {
  const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
  const secs = (seconds % 60).toString().padStart(2, '0');
  return `${mins}:${secs}`;
}

function updatePomodoroDisplay() {
  document.getElementById('pomodoro-clock').textContent = formatTime(remainingTime);
}

function startPomodoro() {
  if (pomodoroInterval) return;
  pomodoroInterval = setInterval(() => {
    if (remainingTime > 0) {
      remainingTime--;
      updatePomodoroDisplay();
    } else {
      clearInterval(pomodoroInterval);
      pomodoroInterval = null;
      alert('ğŸ… ç•ªèŒ„æ—¶é—´ç»“æŸï¼ä¼‘æ¯ä¸€ä¸‹å§~');
    }
  }, 1000);
}

function pausePomodoro() {
  if (pomodoroInterval) {
    clearInterval(pomodoroInterval);
    pomodoroInterval = null;
  }
}

function resetPomodoro() {
  pausePomodoro();
  remainingTime = 25 * 60;
  updatePomodoroDisplay();
}

async function exportReport() {
  const { jsPDF } = window.jspdf;
  const element = document.querySelector('.container');

  const canvas = await html2canvas(element, {
    scale: 2,
    useCORS: true,
    allowTaint: true,
    backgroundColor: null
  });

  const imgData = canvas.toDataURL('image/png');
  const pdf = new jsPDF('p', 'mm', 'a4');
  const imgWidth = 210;
  const pageHeight = 297;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;
  let heightLeft = imgHeight;
  let position = 0;

  pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
  heightLeft -= pageHeight;

  while (heightLeft >= 0) {
    position = heightLeft - imgHeight;
    pdf.addPage();
    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;
  }

  pdf.save(`LearnFlow_æŠ¥å‘Š_${new Date().toISOString().slice(0,10)}.pdf`);
}

function toggleZenMode() {
  isZenMode = !isZenMode;
  document.body.classList.toggle('zen-mode', isZenMode);
  const zenBtn = document.getElementById('zen-mode');
  zenBtn.textContent = isZenMode ? 'é€€å‡ºä¸“æ³¨' : 'ğŸ§˜ ä¸“æ³¨æ¨¡å¼';
    // ç»‘å®šé€€å‡ºæŒ‰é’®äº‹ä»¶ï¼ˆå³ä½¿åˆå§‹éšè—ï¼Œå…ƒç´ ä¹Ÿå­˜åœ¨ï¼‰
  const exitBtn = document.getElementById('exit-zen-mode');
  if (exitBtn) {
    exitBtn.addEventListener('click', toggleZenMode);
  }
}

function backupData() {
  const dataStr = JSON.stringify(plan, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `learnflow-backup-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function restoreData(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (event) => {
    try {
      const restored = JSON.parse(event.target.result);
      Object.assign(plan, restored); // å®‰å…¨åˆå¹¶
      loadTasks();
      updateChart();
      alert('æ•°æ®æ¢å¤æˆåŠŸï¼');
    } catch (err) {
      alert('æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œæ— æ³•æ¢å¤ã€‚');
      console.error(err);
    }
    e.target.value = '';
  };
  reader.readAsText(file);
}

function checkTimeReminders() {
  const now = new Date();
  const currentDate = now.toISOString().split('T')[0];
  const currentHour = String(now.getHours()).padStart(2, '0');
  const currentMinute = String(now.getMinutes()).padStart(2, '0');
  const currentTime = `${currentHour}:${currentMinute}`;

  const tasks = plan[currentDate] || [];
  for (const task of tasks) {
    if (!task.completed && task.time === currentTime) {
      if ('Notification' in window) {
        Notification.requestPermission().then(permission => {
          if (permission === 'granted') {
            new Notification('â° LearnFlow æé†’', {
              body: `ç°åœ¨æ˜¯ ${task.time}ï¼Œè¯¥è¿›è¡Œã€Œ${task.title}ã€äº†ï¼`,
              icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%236D5FE8" d="M12 2L2 7v10c0 5.55 3.84 9.73 9 11 5.16-1.27 9-5.45 9-11V7l-10-5z"/></svg>'
            });
          }
        });
      }
      console.log(`â° æé†’ï¼šç°åœ¨æ˜¯ ${task.time}ï¼Œè¯¥è¿›è¡Œã€Œ${task.title}ã€äº†ï¼`);
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
  // é»˜è®¤é€‰ä¸­ 2026-02-08ï¼ˆå‘¨æ—¥ï¼‰
  document.getElementById('date-select').value = '2026-02-08';

  // ç»‘å®šäº‹ä»¶
  document.getElementById('zen-mode').addEventListener('click', toggleZenMode);
  document.getElementById('backup-data').addEventListener('click', backupData);
  document.getElementById('restore-data').addEventListener('click', () => document.getElementById('restore-file').click());
  document.getElementById('restore-file').addEventListener('change', restoreData);
  document.querySelector('.close').addEventListener('click', closeDetailModal);
  document.getElementById('close-detail').addEventListener('click', closeDetailModal);

  // åˆå§‹åŒ–
  loadTasks();
  updateChart(); // ä½¿ç”¨å›ºå®š7å¤©

  // æ¯åˆ†é’Ÿæ£€æŸ¥æé†’
  setInterval(checkTimeReminders, 60000);
})


  </script>
</body>
</html>
